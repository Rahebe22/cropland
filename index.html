<!DOCTYPE html>
<html>
<head>
    <title>PMTiles OpenLayers Vector with MapTiler Hybrid Base Map</title>
    <meta charset="utf-8"/>
    <script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css">
    <script src="https://unpkg.com/ol-pmtiles@0.3.0/dist/olpmtiles.js"></script>
    <style>
        body, #map {
            height: 100vh;
            margin: 0;
        }
        .country-button, .year-dropdown {
            position: absolute;
            top: 10px; /* Adjust this for both dropdowns if needed */
            right: 10px; /* Positions the dropdowns to the right */
            z-index: 1000;
            padding: 5px 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .year-dropdown {
            top: 60px; /* Positions the year dropdown below the country dropdown */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
        const map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.XYZ({
                        url: 'https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=0rXt9evmwC5e2EW3sauy',
                        attributions: '© MapTiler © OpenStreetMap contributors',
                        maxZoom: 20
                    })
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([3.3, 7.85]),
                zoom: 5
            })
        });

        // Update the regions definition to include URLs for different years
        const regions = {
            'Congo': {
                center: ol.proj.fromLonLat([15.8277, -0.2280]),
                zoom: 7,
                pmtilesUrls: {
                    '2022': "https://raw.githack.com/grace-du/crop-land-maps/main/congo.pmtiles",
                    //'year_2': "https://github/congo/year_2.pmtiles",
                    //'year_3': "https://github/congo/year_3.pmtiles",
                }
            },
            'Ghana': {
                center: ol.proj.fromLonLat([-1.0232, 7.9465]),
                zoom: 7,
                pmtilesUrls: {
                    'year_1': "https://github.com/Rahebe22/cropland/blob/6fe39494316f31c0c50dbb6acc31f1dfcafb38b7/ghana/aoi10_boundarymerge.pmtiles",
                    'year_2': "https://example.com/ghana/year_2.pmtiles",
                    'year_3': "https://example.com/ghana/year_3.pmtiles",
                }
            }
        };

        // Modify the addVectorLayer function to dynamically load the PMTiles
        function addVectorLayer(country, year) {
            const existingLayer = map.getLayers().getArray().find(layer => layer.get('id') === 'vectorLayer');
            if (existingLayer) {
                map.removeLayer(existingLayer);
            }

            const region = regions[country];
            if (!region || !region.pmtilesUrls[year]) return;

            const vectorLayer = new ol.layer.VectorTile({
                source: new olpmtiles.PMTilesVectorSource({
                    url: region.pmtilesUrls[year]
                }),
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: 'yellow',
                        width: 2,
                    })
                }),
                id: 'vectorLayer'
            });
            map.addLayer(vectorLayer);

            map.getView().animate({
                center: region.center,
                zoom: region.zoom,
                duration: 1000
            });
        }

        // Dropdowns setup remains the same
        const countrySelect = document.createElement('select');
        countrySelect.className = 'country-button';
        Object.keys(regions).forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.text = country;
            countrySelect.appendChild(option);
        });

        const yearSelect = document.createElement('select');
        yearSelect.className = 'year-dropdown';
        ['year_1', 'year_2', 'year_3'].forEach(year => {
            const option = document.createElement('option');
            option.value = year;
            option.text = year;
            yearSelect.appendChild(option);
        });

        countrySelect.onchange = () => addVectorLayer(countrySelect.value, yearSelect.value);
        yearSelect.onchange = () => addVectorLayer(countrySelect.value, yearSelect.value);

        document.getElementById('map').appendChild(countrySelect);
        document.getElementById('map').appendChild(yearSelect);

        // Initially load Congo vector layer for year_1
        addVectorLayer('Congo', 'year_1');
    </script>
</body>
</html>
