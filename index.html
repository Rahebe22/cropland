<!DOCTYPE html>
<html>
<head>
    <title>PMTiles OpenLayers Vector with MapTiler Hybrid Base Map</title>
    <meta charset="utf-8"/>
    <script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css">
    <script src="https://unpkg.com/ol-pmtiles@0.3.0/dist/olpmtiles.js"></script>
    <style>
        body, #map {
            height: 100vh;
            margin: 0;
        }
        .country-button, .version-dropdown, .year-dropdown {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 5px 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .version-dropdown {
            top: 60px; /* Adjust position for version dropdown */
        }
        .year-dropdown {
            top: 110px; /* Adjust position for year dropdown */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
        const map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.XYZ({
                        url: 'https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=0rXt9evmwC5e2EW3sauy',
                        attributions: '© MapTiler © OpenStreetMap contributors',
                        maxZoom: 20
                    })
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([3.3, 7.85]),
                zoom: 5
            })
        });

        // Initialize version and year dropdowns without options
        const versionSelect = document.createElement('select');
        versionSelect.className = 'version-dropdown';
        const yearSelect = document.createElement('select');
        yearSelect.className = 'year-dropdown';

        // Function to update the version dropdown based on the selected country
        function updateVersionOptions(country) {
            versionSelect.innerHTML = ''; // Clear existing options
            Object.keys(regions[country].versions).forEach(version => {
                let option = document.createElement('option');
                option.value = version;
                option.text = version;
                versionSelect.appendChild(option);
            });
            updateYearOptions(country, versionSelect.value); // Update years for the initial version
        }

        // Function to update the year dropdown based on the selected country and version
        function updateYearOptions(country, version) {
            yearSelect.innerHTML = ''; // Clear existing options
            Object.keys(regions[country].versions[version]).forEach(year => {
                let option = document.createElement('option');
                option.value = year;
                option.text = year;
                yearSelect.appendChild(option);
            });
        }

        // Modify the addVectorLayer function to include version in the URL selection
        function addVectorLayer(country, version, year) {
            const existingLayer = map.getLayers().getArray().find(layer => layer.get('id') === 'vectorLayer');
            if (existingLayer) {
                map.removeLayer(existingLayer);
            }

            const url = regions[country].versions[version][year];
            if (!url) return;

            const vectorLayer = new ol.layer.VectorTile({
                source: new olpmtiles.PMTilesVectorSource({url: url}),
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: 'yellow',
                        width: 2,
                    })
                }),
                id: 'vectorLayer'
            });
            map.addLayer(vectorLayer);

            map.getView().animate({
                center: regions[country].center,
                zoom: regions[country].zoom,
                duration: 1000
            });
        }

        // Assuming the structure of regions is updated to include versions
        const regions = {
            'Congo': {
                center: ol.proj.fromLonLat([15.8277, -0.2280]),
                zoom: 7,
                versions: {
                    'v1': {
                        '2022': "https://raw.githack.com/grace-du/crop-land-maps/main/congo.pmtiles"
                    }
                }
            },
            'Ghana': {
                center: ol.proj.fromLonLat([-1.0232, 7.9465]),
                zoom: 7,
                versions: {
                    'v1': {
                        '2018': "https://example.com/ghana/v1/2018.pmtiles",
                        '2019': "https://example.com/ghana/v1/2019.pmtiles",
                        '2022': "https://example.com/ghana/v1/2022.pmtiles"
                    }
                }
            }
        };

        // Setup country select dropdown
        const countrySelect = document.createElement('select');
        countrySelect.className = 'country-button';
        Object.keys(regions).forEach(country => {
            let option = document.createElement('option');
            option.value = country;
            option.text = country;
            countrySelect.appendChild(option);
        });

        // Add event listeners to dropdowns
        countrySelect.onchange = () => {
            updateVersionOptions(countrySelect.value);
        };
        versionSelect.onchange = () => {
            updateYearOptions(countrySelect.value, versionSelect.value);
        };
        yearSelect.onchange = () => {
            addVectorLayer(countrySelect.value, versionSelect.value, yearSelect.value);
        };

        // Append dropdowns to the DOM
        document.getElementById('map').appendChild(countrySelect);
        document.getElementById('map').appendChild(versionSelect);
        document.getElementById('map').appendChild(yearSelect);

        // Initialize the map with the first country's first version and year
        window.onload = () => {
            countrySelect.onchange();
        };
    </script>
</body>
</html>
