<!DOCTYPE html>
<html>
<head>
    <title>PMTiles OpenLayers Vector with MapTiler Hybrid Base Map</title>
    <meta charset="utf-8"/>
    <script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css">
    <script src="https://unpkg.com/ol-pmtiles@0.3.0/dist/olpmtiles.js"></script>
    <style>
        body, #map {
            height: 100vh;
            margin: 0;
        }
        .country-button, .version-dropdown, .year-dropdown {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 5px 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 5px;
        }
        .version-dropdown {
            top: 60px; /* Positions the version dropdown below the country dropdown */
        }
        .year-dropdown {
            top: 110px; /* Positions the year dropdown below the version dropdown */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
        const map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.XYZ({
                        url: 'https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=your_api_key',
                        attributions: '© MapTiler © OpenStreetMap contributors',
                        maxZoom: 20
                    })
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([3.3, 7.85]),
                zoom: 5
            })
        });

        // Updated regions definition to include versions
        const regions = {
            'Congo': {
                center: ol.proj.fromLonLat([15.8277, -0.2280]),
                zoom: 7,
                versions: {
                    'v1': {
                        '2022': "https://raw.githack.com/grace-du/crop-land-maps/main/congo.pmtiles",
                        //'year_2': "https://example.com/congo/v1/year_2.pmtiles",
                        //'year_3': "https://example.com/congo/v1/year_3.pmtiles",
                    },
                    // Additional versions can be added similarly
                }
            },
            'Ghana': {
                center: ol.proj.fromLonLat([-1.0232, 7.9465]),
                zoom: 7,
                versions: {
                    'v1': {
                        'year_1': "https://example.com/ghana/v1/year_1.pmtiles",
                        'year_2': "https://example.com/ghana/v1/year_2.pmtiles",
                        'year_3': "https://example.com/ghana/v1/year_3.pmtiles",
                    },
                    // Additional versions can be added similarly
                }
            }
        };

        const countrySelect = document.createElement('select');
        const versionSelect = document.createElement('select');
        const yearSelect = document.createElement('select');
        countrySelect.className = 'country-button';
        versionSelect.className = 'version-dropdown';
        yearSelect.className = 'year-dropdown';

        Object.keys(regions).forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.text = country;
            countrySelect.appendChild(option);
        });

        countrySelect.onchange = () => {
            // Clear previous options
            versionSelect.innerHTML = '';
            yearSelect.innerHTML = '';
            const versions = regions[countrySelect.value].versions;
            Object.keys(versions).forEach(version => {
                const option = document.createElement('option');
                option.value = version;
                option.text = version;
                versionSelect.appendChild(option);
            });
            // Automatically trigger version change to populate years
            versionSelect.onchange();
        };

        versionSelect.onchange = () => {
            // Clear previous options
            yearSelect.innerHTML = '';
            const selectedCountry = regions[countrySelect.value];
            const selectedVersion = selectedCountry.versions[versionSelect.value];
            Object.keys(selectedVersion).forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.text = year;
                yearSelect.appendChild(option);
            });
        };

        yearSelect.onchange = () => {
            const selectedCountry = regions[countrySelect.value];
            const selectedVersion = selectedCountry.versions[versionSelect.value];
            const pmtilesUrl = selectedVersion[yearSelect.value];
            addVectorLayer(pmtilesUrl);
        };

        function addVectorLayer(pmtilesUrl) {
            const existingLayer = map.getLayers().getArray().find(layer => layer.get('id') === 'vectorLayer');
            if (existingLayer) {
                map.removeLayer(existingLayer);
            }

            const vectorLayer = new ol.layer.VectorTile({
                source: new olpmtiles.PMTilesVectorSource({
                    url: pmtilesUrl
                }),
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: 'yellow',
                        width: 2,
                    })
                }),
                id: 'vectorLayer'
            });
            map.addLayer(vectorLayer);

            // Assuming the center and zoom for each country are predefined in the regions object
            const regionInfo = regions[countrySelect.value];
            map.getView().animate({
                center: regionInfo.center,
                zoom: regionInfo.zoom,
                duration: 1000
            });
        }

        document.getElementById('map').appendChild(countrySelect);
        document.getElementById('map').appendChild(versionSelect);
        document.getElementById('map').appendChild(yearSelect);

        // Initialize dropdowns
        countrySelect.onchange();

    </script>
</body>
</html>
